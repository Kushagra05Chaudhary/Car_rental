<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Car Rental System{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js for interactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.4s ease-in;
        }
        .animate-slide-down {
            animation: slideDown 0.3s ease-out;
        }
        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }
        .animate-slide-in-left {
            animation: slideInLeft 0.3s ease-out;
        }
        .animate-slide-in-right {
            animation: slideInRight 0.3s ease-out;
        }
        .animate-scale-in {
            animation: scaleIn 0.2s ease-out;
        }
        .animate-spin-slow {
            animation: spin 2s linear infinite;
        }
        
        button, a, input, textarea, select {
            @apply transition-all duration-200;
        }
        
        .btn-primary {
            @apply inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-blue-800 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 active:scale-95;
        }
        
        .btn-secondary {
            @apply inline-flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 active:scale-95;
        }
        
        .btn-danger {
            @apply inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-2 active:scale-95;
        }
        
        input:focus, textarea:focus, select:focus {
            @apply ring-2 ring-blue-500 ring-opacity-50;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-slate-50 text-gray-900">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50 border-b border-gray-200">
        <div class="max-w-full px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-3">
                    <div class="text-3xl">üöó</div>
                    <a href="/" class="text-xl font-bold text-gray-900 hover:text-blue-600">CarRent</a>
                </div>
                
                <div class="flex items-center gap-6">
                    {% if user.is_authenticated %}
                        <div class="hidden md:flex items-center gap-6">
                            {% if user.is_superuser or user.role == 'admin' %}
                                <a href="{% url 'admin_dashboard' %}" class="text-gray-600 hover:text-gray-900 font-medium">Dashboard</a>
                                <a href="{% url 'admin_owner_management' %}" class="text-gray-600 hover:text-gray-900 font-medium">Owners</a>
                                <a href="{% url 'admin_user_management' %}" class="text-gray-600 hover:text-gray-900 font-medium">Users</a>
                                <a href="{% url 'admin_car_list' %}" class="text-gray-600 hover:text-gray-900 font-medium">Cars</a>
                                <a href="{% url 'admin_booking_list' %}" class="text-gray-600 hover:text-gray-900 font-medium">Bookings</a>
                                <a href="{% url 'admin_reports' %}" class="text-gray-600 hover:text-gray-900 font-medium">Reports</a>
                            {% elif user.role == 'owner' %}
                                <a href="{% url 'owner_dashboard' %}" class="text-gray-600 hover:text-gray-900 font-medium">üìä Dashboard</a>
                                <a href="{% url 'owner_car_list' %}" class="text-gray-600 hover:text-gray-900 font-medium">üöó Cars</a>
                                <a href="{% url 'owner_booking_list' %}" class="text-gray-600 hover:text-gray-900 font-medium">üìÖ Bookings</a>
                                <a href="{% url 'owner_earnings' %}" class="text-gray-600 hover:text-gray-900 font-medium">üí∞ Earnings</a>
                            {% endif %}
                        </div>
                        
                        <div class="relative" x-data="{ open: false }">
                            <button @click="open = !open" class="flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-lg hover:bg-blue-100 font-medium text-gray-900">
                                üë§ <span class="hidden sm:inline">{{ user.first_name|default:user.username }}</span>
                                <svg class="w-4 h-4 transition-transform" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                                </svg>
                            </button>
                            
                            <div x-show="open" @click.away="open = false" class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden animate-scale-in" style="display: none;">
                                {% if user.is_superuser or user.role == 'admin' %}
                                    <a href="{% url 'admin_dashboard' %}" class="block px-4 py-3 hover:bg-gray-50 border-b border-gray-100">Admin Console</a>
                                {% elif user.role == 'owner' %}
                                    <a href="{% url 'owner_profile' %}" class="block px-4 py-3 hover:bg-gray-50 border-b border-gray-100">üë§ My Profile</a>
                                    <a href="{% url 'owner_profile_edit' %}" class="block px-4 py-3 hover:bg-gray-50 border-b border-gray-100">‚öôÔ∏è Settings</a>
                                {% endif %}
                                <a href="{% url 'logout' %}" class="block px-4 py-3 hover:bg-red-50 text-red-600 font-medium">üö™ Logout</a>
                            </div>
                        </div>
                    {% else %}
                        <a href="{% url 'login' %}" class="text-gray-600 hover:text-gray-900 font-medium">Login</a>
                        <a href="{% url 'register' %}" class="btn-primary">Sign Up</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="min-h-[calc(100vh-64px)]">
        {% if messages %}
            <div class="space-y-2 p-4 max-w-7xl mx-auto">
                {% for message in messages %}
                    <div class="animate-slide-down rounded-lg px-4 py-3 {% if message.tags == 'success' %}bg-green-50 border border-green-200 text-green-800{% elif message.tags == 'error' %}bg-red-50 border border-red-200 text-red-800{% else %}bg-blue-50 border border-blue-200 text-blue-800{% endif %}" data-toast data-type="{% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% else %}info{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
        {% block content %}{% endblock %}
    </main>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2 pointer-events-none"></div>

    <script>
        function showToast(message, type = 'info', duration = 4000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const colors = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-yellow-500',
                'info': 'bg-blue-500'
            };
            
            const icons = {
                'success': '‚úì',
                'error': '‚úï',
                'warning': '‚ö†',
                'info': '‚Ñπ'
            };
            
            toast.className = `${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg animate-slide-up flex items-center justify-between gap-4 min-w-max pointer-events-auto`;
            toast.innerHTML = `
                <span class="font-bold text-lg">${icons[type]}</span>
                <span>${message}</span>
                <button class="ml-2 hover:opacity-80 transition-opacity" onclick="this.parentElement.remove()">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            `;
            
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'slideUp 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }
    </script>
</body>
</html>